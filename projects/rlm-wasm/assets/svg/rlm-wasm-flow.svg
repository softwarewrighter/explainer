<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    <linearGradient id="userGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4ade80"/>
      <stop offset="100%" style="stop-color:#22c55e"/>
    </linearGradient>
    <linearGradient id="rlmGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e94560"/>
      <stop offset="100%" style="stop-color:#c73e54"/>
    </linearGradient>
    <linearGradient id="llmGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#2563eb"/>
    </linearGradient>
    <linearGradient id="wasmGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>

    <marker id="arrow" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#00d4ff"/>
    </marker>
    <marker id="arrowOrange" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#f59e0b"/>
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#4ade80"/>
    </marker>
  </defs>

  <style>
    text { font-family: 'SF Pro Display', -apple-system, sans-serif; font-size: 24px; fill: white; }
    .title { font-size: 52px; font-weight: 700; fill: #00d4ff; }
    .subtitle { font-size: 28px; fill: #888; }
    .bold { font-weight: 700; }
    .dim { fill: #aaa; }
    .highlight { fill: #fca; }
  </style>

  <!-- Background -->
  <rect width="1920" height="1080" fill="url(#bgGrad)"/>

  <!-- Title -->
  <text x="960" y="80" text-anchor="middle" class="title">RLM Level 2: WASM Architecture</text>
  <text x="960" y="125" text-anchor="middle" class="subtitle">LLM writes Rust code, WASM executes it safely</text>

  <!-- ============================================ -->
  <!-- MAIN FLOW: LEFT TO RIGHT -->
  <!-- ============================================ -->

  <!-- USER INPUT -->
  <g transform="translate(80, 320)">
    <rect x="0" y="0" width="280" height="200" rx="20" fill="url(#userGrad)" opacity="0.9"/>
    <text x="140" y="50" text-anchor="middle" class="bold">User Query</text>
    <text x="140" y="95" text-anchor="middle">"Rank errors by frequency"</text>
    <text x="140" y="140" text-anchor="middle">+ 200 line log file</text>
  </g>

  <!-- Arrow 1 -->
  <path d="M 360 420 L 480 420" fill="none" stroke="#4ade80" stroke-width="4" marker-end="url(#arrowGreen)"/>

  <!-- RLM ORCHESTRATOR -->
  <g transform="translate(500, 280)">
    <rect x="0" y="0" width="320" height="280" rx="20" fill="url(#rlmGrad)" opacity="0.95"/>
    <text x="160" y="50" text-anchor="middle" class="bold">RLM Orchestrator</text>
    <text x="160" y="100" text-anchor="middle">1. Ask LLM for operation</text>
    <text x="160" y="145" text-anchor="middle">2. Get Rust code from Coder</text>
    <text x="160" y="190" text-anchor="middle">3. Compile to WASM</text>
    <text x="160" y="235" text-anchor="middle">4. Execute with data</text>
  </g>

  <!-- Arrow 2: RLM to LLMs (bidirectional shown as loop) -->
  <path d="M 660 280 Q 660 180 800 180 Q 940 180 940 280" fill="none" stroke="#00d4ff" stroke-width="4" marker-end="url(#arrow)"/>
  <text x="800" y="155" text-anchor="middle" style="font-size:20px;fill:#00d4ff;">LLM calls</text>

  <!-- LLM BOX (combined) -->
  <g transform="translate(860, 280)">
    <rect x="0" y="0" width="300" height="180" rx="20" fill="url(#llmGrad)" opacity="0.9"/>
    <text x="150" y="50" text-anchor="middle" class="bold">LLMs</text>
    <text x="150" y="100" text-anchor="middle">Base: chooses operation</text>
    <text x="150" y="145" text-anchor="middle">Coder: writes Rust code</text>
  </g>

  <!-- Arrow 3: RLM to WASM -->
  <path d="M 820 500 L 1020 600" fill="none" stroke="#f59e0b" stroke-width="4" marker-end="url(#arrowOrange)"/>
  <text x="880" y="570" text-anchor="middle" style="font-size:20px;fill:#f59e0b;">compile + data</text>

  <!-- WASM SANDBOX -->
  <g transform="translate(1020, 560)">
    <rect x="0" y="0" width="340" height="240" rx="20" fill="url(#wasmGrad)" opacity="0.9"/>
    <text x="170" y="50" text-anchor="middle" class="bold">WASM Sandbox</text>
    <text x="170" y="100" text-anchor="middle">Map: extract from each line</text>
    <text x="170" y="145" text-anchor="middle">Reduce: aggregate results</text>
    <text x="170" y="195" text-anchor="middle" class="highlight">Secure, memory-limited</text>
  </g>

  <!-- Arrow 4: WASM to Results -->
  <path d="M 1360 680 L 1500 680" fill="none" stroke="#4ade80" stroke-width="4" marker-end="url(#arrowGreen)"/>

  <!-- RESULTS -->
  <g transform="translate(1520, 560)">
    <rect x="0" y="0" width="300" height="240" rx="20" fill="url(#userGrad)" opacity="0.85"/>
    <text x="150" y="50" text-anchor="middle" class="bold">Results</text>
    <text x="150" y="100" text-anchor="middle">AuthFailed: 60</text>
    <text x="150" y="145" text-anchor="middle">DatabaseError: 40</text>
    <text x="150" y="190" text-anchor="middle">NetworkTimeout: 20</text>
  </g>

  <!-- ============================================ -->
  <!-- BOTTOM INFO BOXES -->
  <!-- ============================================ -->

  <!-- WASM Operations -->
  <g transform="translate(80, 820)">
    <rect x="0" y="0" width="500" height="160" rx="16" fill="rgba(245,158,11,0.15)" stroke="#f59e0b" stroke-width="2"/>
    <text x="250" y="45" text-anchor="middle" class="bold" style="fill:#f59e0b;">WASM Operations</text>
    <text x="250" y="95" text-anchor="middle">rust_wasm_mapreduce: count, unique, sum</text>
    <text x="250" y="135" text-anchor="middle">rust_wasm_intent: sorting, percentiles</text>
  </g>

  <!-- Security -->
  <g transform="translate(620, 820)">
    <rect x="0" y="0" width="480" height="160" rx="16" fill="rgba(34,197,94,0.12)" stroke="#22c55e" stroke-width="2"/>
    <text x="240" y="45" text-anchor="middle" class="bold" style="fill:#22c55e;">Security</text>
    <text x="240" y="95" text-anchor="middle">Sandboxed execution, fuel-limited</text>
    <text x="240" y="135" text-anchor="middle">No network or filesystem access</text>
  </g>

  <!-- Capability Levels -->
  <g transform="translate(1140, 820)">
    <rect x="0" y="0" width="680" height="160" rx="16" fill="rgba(0,0,0,0.3)"/>
    <text x="340" y="45" text-anchor="middle" class="bold">Capability Levels</text>
    <text x="340" y="95" text-anchor="middle">L1: DSL (find, regex)  |  <tspan class="highlight">L2: WASM (this video)</tspan></text>
    <text x="340" y="135" text-anchor="middle" class="dim">L3: CLI (future)  |  L4: Recursive LLM (future)</text>
  </g>

</svg>